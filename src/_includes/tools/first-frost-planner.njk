    <section class="card" aria-label="Fall planting planner inputs">
      <div class="grid">
        <div class="row">
          <div>
            <label for="firstFrost">Average first fall frost date</label>
            <input id="firstFrost" type="date" aria-describedby="firstFrostHelp" />
            <div class="small" id="firstFrostHelp">Use an average date for your area (not the earliest ever).</div>
          </div>

          <div>
            <label for="crop">Crop</label>
            <select id="crop" aria-describedby="cropHelp"></select>
            <div class="small" id="cropHelp">Days to maturity are typical ranges. Varieties and weather can vary.</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="protection">Season extension</label>
            <select id="protection" aria-describedby="protectionHelp">
              <option value="0">None</option>
              <option value="7">Light protection (row cover / cloche) — ~1 week</option>
              <option value="14">Stronger protection (tunnel / cold frame) — ~2 weeks</option>
            </select>
            <div class="small" id="protectionHelp">This shifts your effective frost date later by ~1–2 weeks.</div>
          </div>

          <div>
            <label for="buffer">Safety buffer</label>
            <select id="buffer" aria-describedby="bufferHelp">
              <option value="7">Conservative (7 days)</option>
              <option value="10" selected>Standard (10 days)</option>
              <option value="14">Extra cautious (14 days)</option>
              <option value="0">None</option>
            </select>
            <div class="small" id="bufferHelp">Accounts for slower fall growth, cool soil, and harvest delays.</div>
          </div>
        </div>

        <div class="btnRow">
          <button class="button primary" id="calcBtn" type="button">Calculate</button>
          <button class="button" id="resetBtn" type="button">Reset</button>
          <button class="button" id="printBtn" type="button" style="display:none;">Print results</button>
        </div>
      </div>
    </section>

    <section class="card" id="resultsCard" style="display:none;">
      <h2>Results</h2>

      <div class="note" id="confidenceBox"></div>

      <table>
        <thead>
          <tr>
            <th>Item</th>
            <th>Result</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody id="resultsBody"></tbody>
      </table>

      <div class="note small" style="opacity:0.86;">
        <span class="pill">Planning tip</span>
        Fall growth often slows as days shorten. If you’re close to the cutoff, choose faster varieties or add protection.
      </div>
    </section>

    <section class="card">
      <h2>How this works</h2>
      <p>
        We start with your <strong>average first fall frost date</strong>. Then we adjust it by any season protection you select.
        From that “effective frost date,” we subtract your crop’s typical days to maturity plus a safety buffer.
      </p>
      <p class="small" style="opacity:0.82;">
        This is a planning tool, not a guarantee. Weather swings, variety choice, and fall light levels can shift results.
      </p>
    </section>

    <section class="card">
      <h2>Related</h2>
      <ul>
        <li><a href="/tools/seed-start-planner.html">Seed Starting Planner</a></li>
        <li><a href="/guides/seed-starting-short-season.html">Seed starting method for short seasons (guide)</a></li>
      </ul>
    </section>

    <footer class="footer">
      <p><a href="/">← Back to GrowByDate</a></p>
    </footer>
  </main>

  <script>
    // Notes:
    // - days: typical days to maturity (rough planning)
    // - hardy: true means it tolerates light frosts better (still slows down in cold)
    const CROPS = [
      { id: "radish",   name: "Radishes",      days: 30, hardy: true,  notes: "Fast and forgiving. Great late-season choice." },
      { id: "spinach",  name: "Spinach",       days: 45, hardy: true,  notes: "Cold-hardy, but can stall in deep cold." },
      { id: "lettuce",  name: "Lettuce",       days: 50, hardy: true,  notes: "Handles cool weather well; protect from hard freezes." },
      { id: "arugula",  name: "Arugula",       days: 35, hardy: true,  notes: "Quick harvest. Can handle cool nights." },
      { id: "kale",     name: "Kale",          days: 60, hardy: true,  notes: "Very cold-tolerant; quality improves after light frosts." },
      { id: "bokchoy",  name: "Bok choy",      days: 45, hardy: true,  notes: "Fast fall crop; watch for bolting in heat." },
      { id: "beet",     name: "Beets",         days: 60, hardy: true,  notes: "Roots size up slower in cold; buffer helps." },
      { id: "carrot",   name: "Carrots",       days: 70, hardy: true,  notes: "Slower to mature; consider smaller/faster varieties." },
      { id: "broccoli", name: "Broccoli",      days: 75, hardy: true,  notes: "Can work, but is close in short falls—variety choice matters." },
      { id: "beans",    name: "Bush beans",    days: 55, hardy: false, notes: "Not frost-tolerant. Needs warmth and time." }
    ];

    const byId = (id) => document.getElementById(id);

    function initCropSelect() {
      const sel = byId("crop");
      sel.innerHTML = "";
      for (const c of CROPS) {
        const opt = document.createElement("option");
        opt.value = c.id;
        opt.textContent = c.name;
        sel.appendChild(opt);
      }
    }

    function toDate(inputValue) {
      if (!inputValue) return null;
      const [y, m, d] = inputValue.split("-").map(Number);
      return new Date(y, m - 1, d, 12, 0, 0, 0); // local noon to reduce DST issues
    }

    function addDays(date, days) {
      const out = new Date(date);
      out.setDate(out.getDate() + days);
      return out;
    }

    function fmt(date) {
      return date.toLocaleDateString(undefined, { year: "numeric", month: "short", day: "numeric" });
    }

    function addRow(item, result, notes) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><strong>${item}</strong></td>
        <td>${result}</td>
        <td style="opacity:0.85;">${notes || ""}</td>
      `;
      byId("resultsBody").appendChild(tr);
    }

    function confidenceLabel(daysMargin, hardy) {
      // Margin is how many days you have AFTER maturity+buffer before frost.
      // More margin = higher confidence.
      if (daysMargin >= 14) return { cls: "ok",  title: "High confidence", text: "You have a comfortable buffer before frost." };
      if (daysMargin >= 7)  return { cls: "warn", title: "Medium confidence", text: "This is workable, but variety choice and protection may matter." };
      // If hardy, small negative margins can still be plausible with protection/harvest stages
      if (hardy && daysMargin >= -3) return { cls: "warn", title: "Borderline", text: "Close to frost. Consider protection and fast varieties." };
      return { cls: "risk", title: "Low confidence", text: "This is likely too tight for reliable maturity in most short seasons." };
    }

    function calculate() {
      const firstFrost = toDate(byId("firstFrost").value);
      const protectionDays = parseInt(byId("protection").value, 10) || 0;
      const bufferDays = parseInt(byId("buffer").value, 10) || 0;
      const crop = CROPS.find(c => c.id === byId("crop").value);

      byId("resultsBody").innerHTML = "";
      byId("printBtn").style.display = "none";
      byId("resultsCard").style.display = "none";

      if (!firstFrost) {
        alert("Please enter an average first fall frost date.");
        return;
      }

      const effectiveFrost = addDays(firstFrost, protectionDays);
      const lastSow = addDays(effectiveFrost, -(crop.days + bufferDays));

      // If you sow on "lastSow", maturity lands at:
      const maturityDate = addDays(lastSow, crop.days);
      const daysMargin = Math.round((effectiveFrost - maturityDate) / (1000 * 60 * 60 * 24));

      const conf = confidenceLabel(daysMargin, crop.hardy);
      const box = byId("confidenceBox");
      box.className = `note ${conf.cls}`;
      box.innerHTML = `<span class="pill">${conf.title}</span> ${conf.text}`;

      addRow("Crop", crop.name, crop.notes);
      addRow("Average first frost date", fmt(firstFrost), "Your input.");
      addRow("Effective frost date", fmt(effectiveFrost), protectionDays ? `Includes ~${protectionDays} days of protection.` : "No protection applied.");
      addRow("Safety buffer", `${bufferDays} days`, "Extra time to account for slower fall growth.");
      addRow("Latest recommended sow date", fmt(lastSow), "Aim to sow on or before this date for the best chance to finish.");
      addRow("Estimated maturity date (if sown on the latest date)", fmt(maturityDate), "Actual timing depends on variety and conditions.");
      addRow("Timing margin", `${daysMargin} days`, daysMargin >= 0 ? "Days remaining before frost." : "Maturity is projected after frost.");

      byId("resultsCard").style.display = "block";
      byId("printBtn").style.display = "inline-block";
    }

    function resetForm() {
      byId("firstFrost").value = "";
      byId("protection").value = "0";
      byId("buffer").value = "10";
      byId("crop").selectedIndex = 0;
      byId("resultsBody").innerHTML = "";
      byId("resultsCard").style.display = "none";
      byId("printBtn").style.display = "none";
    }

    function printResults() {
      window.print();
    }

    initCropSelect();
    byId("calcBtn").addEventListener("click", calculate);
    byId("resetBtn").addEventListener("click", resetForm);
    byId("printBtn").addEventListener("click", printResults);
  </script>
</body>
</html>
